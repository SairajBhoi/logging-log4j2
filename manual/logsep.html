<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Logging Separation :: Apache Log4j</title>
    <link rel="canonical" href="https://logging.apache.org/log4j/2.x/manual/logsep.html">
    <meta name="generator" content="Antora 3.2.0-alpha.4">
<link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/../_images/favicon.ico" type="image/x-icon">
<!-- `@asciidoctor/tabs` extension styles -->
<link rel="stylesheet" href="../_/css/vendor/tabs.css">
<style>
  /* `page-toclevels` greater than 4 are not supported by Antora UI, patching it: */
  .toc .toc-menu li[data-level="4"] a {
    padding-left: 2.75rem
  }
  /* Replace the default highlight.js color for strings from red to green: */
  .hljs-string {
    color: #0f8532;
  }
</style>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <img src="../_/../_images/logo-small-white.png" alt="Apache Log4j"/>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://logging.apache.org">a subproject of&nbsp;<strong>Apache Logging Services</strong></a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Home</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../download.html">Download</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../runtime-dependencies.html">Runtime Dependencies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes.html">Release Notes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../support.html">Support</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../thanks.html">Thanks</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Learn</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Manual</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migration.html">Migrating from Log4j 1.x to 2.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="api.html">Log4j API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="logbuilder.html">Log Builder</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="flowtracing.html">Flow Tracing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="markers.html">Markers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="eventlogging.html">Event Logging</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="messages.html">Messages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="thread-context.html">Thread Context</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scoped-context.html">Scoped Context</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="resource-logger.html">Resource Logging</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud.html">Using Log4j in Cloud Enabled Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lookups.html">Lookups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appenders.html">Appenders</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="layouts.html">Layouts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="json-template-layout.html">JSON Template Layout</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="filters.html">Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="async.html">Lock-free Asynchronous Loggers for Low-Latency Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="garbagefree.html">Garbage-free Steady State Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extending.html">Extending Log4j</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="customconfig.html">Programmatic Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="customloglevels.html">Custom Log Levels</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jmx.html">JMX</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="logsep.html">Logging Separation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="performance.html">Performance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../plugin-reference.html">Plugin reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javadoc.html">Java API reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../articles.html">Articles</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">F.A.Q.</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-api.html">Log4j API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-1.2-api.html">Log4j 1.2 Bridge</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-slf4j-impl.html">Log4j SLF4J Binding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-jul.html">Log4j JDK Logging Adapter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-jpl.html">Log4j JDK Platform Logging Adapter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-to-slf4j.html">Log4j to SLF4J Adapter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-flume-ng.html">Flume Appender</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-mongodb3.html">MongoDB 3 appender</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-mongodb4.html">MongoDB 4 appender</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-iostreams.html">Log4j IOStreams</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-docker.html">Log4j Docker Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-spring-cloud-config-client.html">Log4j Spring Cloud Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Related projects</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/jakarta">Log4j Jakarta EE</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/jmx-gui">Log4j JMX GUI</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/kotlin">Log4j Kotlin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/scala">Log4j Scala</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/tools">Log4j Tools</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/transform">Log4j Transformation Tools</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Home</a></li>
    <li>Learn</li>
    <li><a href="index.html">Manual</a></li>
    <li><a href="logsep.html">Logging Separation</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/apache/logging-log4j2/edit/2.x/src/site/antora/modules/ROOT/pages/manual/logsep.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="4">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Logging Separation</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>There are many well known use cases where applications may share an
environment with other applications and each has a need to have its own,
separate logging environment. This purpose of this section is to discuss
some of these cases and ways to accomplish this.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="UseCases"><a class="anchor" href="#UseCases"></a>Use Cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes some of the use cases where Log4j could be used
and what its desired behavior might be.</p>
</div>
<div class="sect2">
<h3 id="_standalone_application"><a class="anchor" href="#_standalone_application"></a>Standalone Application</h3>
<div class="paragraph">
<p>Standalone applications are usually relatively simple. They typically
have one bundled executable that requires only a single logging
configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_web_applications"><a class="anchor" href="#_web_applications"></a>Web Applications</h3>
<div class="paragraph">
<p>A typical web application will be packaged as a WAR file and will
include all of its dependencies in WEB-INF/lib and will have its
configuration file located in the class path or in a location configured
in the web.xml. Be sure to follow the instructions in <a href="http://logging.apache.org/log4j/jakarta">Log4j Jakarta EE</a> page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_java_ee_applications"><a class="anchor" href="#_java_ee_applications"></a>Java EE Applications</h3>
<div class="paragraph">
<p>A Java EE application will consist of one or more WAR files and possible
some EJBs, typically all packaged in an EAR file. Usually, it is
desirable to have a single configuration that applies to all the
components in the EAR. The logging classes will generally be placed in a
location shared across all the components and the configuration needs to
also be shareable. Be sure to follow the instructions in the
<a href="http://logging.apache.org/log4j/jakarta">Log4j Jakarta EE</a> page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_shared_web_applications_and_rest_service_containers"><a class="anchor" href="#_shared_web_applications_and_rest_service_containers"></a>"Shared" Web Applications and REST Service Containers</h3>
<div class="paragraph">
<p>In this scenario there are multiple WAR files deployed into a single
container. Each of the applications should use the same logging
configuration and share the same logging implementation across each of
the web applications. When writing to files and streams each of the
applications should share them to avoid the issues that can occur when
multiple components try to write to the same file(s) through different
File objects, channels, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_osgi_applications"><a class="anchor" href="#_osgi_applications"></a>OSGi Applications</h3>
<div class="paragraph">
<p>An OSGi container physically separates each JAR into its own
ClassLoader, thus enforcing modularity of JARs as well as providing
standardized ways for JARs to share code based on version numbers.
Suffice to say, the OSGi framework is beyond the scope of this manual.
There are some differences when using Log4j in an OSGi container. By
default, each JAR bundle is scanned for its own Log4j configuration
file. Similar to the web application paradigm, every bundle has its own
LoggerContext. As this may be undesirable when a global Log4j
configuration is wanted, then the
<a href="extending.html#ContextSelector" class="xref page">ContextSelector</a> should be
overridden with <code>BasicContextSelector</code> or <code>JndiContextSelector</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Approaches"><a class="anchor" href="#Approaches"></a>Approaches</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_simple_approach"><a class="anchor" href="#_the_simple_approach"></a>The Simple Approach</h3>
<div class="paragraph">
<p>The simplest approach for separating logging within applications is to
package each application with its own copy of Log4j and to use the
BasicContextSelector. While this works for standalone applications and
may work for web applications and possibly Java EE applications, it does
not work at all in the last case. However, when this approach does work
it should be used as it is ultimately the simplest and most
straightforward way of implementing logging.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_context_selectors"><a class="anchor" href="#_using_context_selectors"></a>Using Context Selectors</h3>
<div class="paragraph">
<p>There are a few patterns for achieving the desired state of logging
separation using ContextSelectors:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Place the logging jars in the container&#8217;s classpath and set the
system property <code>log4j2.contextSelector</code> to
<code>org.apache.logging.log4j.core.selector.BasicContextSelector</code>. This will
create a single LoggerContext using a single configuration that will be
shared across all applications.</p>
</li>
<li>
<p>Place the logging jars in the container&#8217;s classpath and use the
default ClassLoaderContextSelector. Follow the
<a href="webapp.html" class="xref page">instructions to initialize Log4j 2 in a web
application</a>. Each application can be configured to share the same
configuration used at the container or can be individually configured.
If status logging is set to debug in the configuration there will be
output from when logging is initialized in the container and then again
in each web application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>JndiContextSelector</code> will not work unless <code>log4j2.enableJndi=true</code> is set as a system property
or environment variable. See the
<a href="configuration.html#enableJndi" class="xref page">log4j2.enableJndi</a> system property.</p>
</div>
<div class="paragraph">
<p>The exact method for setting system properties depends on the container.
For Tomcat, edit <code>$CATALINA_HOME/conf/catalina.properties</code>. Consult the
documentation for other web containers.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>
    Copyright © 1999-2024 <a href="https://www.apache.org/">The Apache Software Foundation</a>.
    Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache Software License, Version 2.0</a>.
    Please read our <a href="https://privacy.apache.org/policies/privacy-policy-public.html">privacy policy</a>.
  </p>
  <p>
    Apache, Log4j, and the Apache feather logo are trademarks or registered trademarks of The Apache Software Foundation.
    Oracle and Java are registered trademarks of Oracle and/or its affiliates.
    Other names may be trademarks of their respective owners.
  </p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<!-- `@asciidoctor/tabs` extension scripts -->
<script async src="../_/js/vendor/tabs.js"></script>
  </body>
</html>
